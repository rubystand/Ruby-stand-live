<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ruby Standlive Checkout</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;600;700&display=swap" rel="stylesheet">
<style>
body {font-family:'Poppins',sans-serif; background:#f4f6f8; margin:0; padding:20px; display:flex; justify-content:center;}
.container {background:#fff; padding:25px; border-radius:16px; max-width:600px; width:100%; box-shadow:0 8px 25px rgba(0,0,0,0.1);}
h1 {text-align:center; color:#d72a6e;}
form {display:flex; flex-direction:column; gap:12px;}
label {font-weight:600;}
input, select, textarea {padding:10px; border:1px solid #ccc; border-radius:8px; width:100%;}
textarea{resize:vertical;}
.options{display:flex; flex-direction:column; gap:6px;}
.price-display{background:#f3f3f3; padding:10px; border-radius:8px; font-weight:bold; text-align:center; margin-top:10px;}
.note{background:#f0f8ff; padding:10px; border-left:4px solid #0070ba; border-radius:8px; font-size:14px; margin-top:10px;}
#paypal-button-container {margin-top:15px;}
button {padding:12px; border:none; border-radius:10px; background:#0070ba; color:#fff; font-weight:600; cursor:pointer; margin-top:12px;}
button:hover {opacity:0.9;}
</style>
</head>
<body>
<div class="container">
<h1>💎 Ruby Standlive</h1>
<form id="payment-form">
<label>Référence *</label>
<input type="text" id="reference" required>
<label>Nom d’utilisateur TikTok *</label>
<input type="text" id="tiktok" placeholder="@username" required>
<label>Prix de l’article (€) *</label>
<input type="number" id="price" min="1" required>
<label>Pays de livraison *</label>
<select id="country" required onchange="updateDeliveryOptions()">
<option value="">-- Sélectionner --</option>
<option value="france">🇫🇷 France</option>
<option value="belgique">🇧🇪 Belgique</option>
<option value="europe">🌍 Europe</option>
</select>
<label>Nom complet *</label>
<input type="text" id="name" required>
<label>Adresse complète *</label>
<textarea id="address" rows="3" required></textarea>
<div id="delivery-container">
<label>Choix de livraison *</label>
<div class="options" id="delivery-options"></div>
</div>
<div class="note">🚚 Livraison gratuite France/Belgique dès 50€, Europe dès 80€.</div>
<div class="price-display" id="total">Total: -- €</div>
<div id="paypal-button-container"></div>
</form>
</div>

<script src="https://www.paypal.com/sdk/js?client-id=AZzgcx4vB44x5TSfE_ljE&currency=EUR"></script>
<script>
const deliveryPrices = {france:{locker:3.8, point:4.9, domicile:6.9}, belgique:{locker:3.8, point:4.9, domicile:6.9}, europe:{point:7.99}};
const form = document.getElementById('payment-form');
const deliveryOptionsDiv = document.getElementById('delivery-options');
const totalDisplay = document.getElementById('total');
let totalAmount = 0;

function updateDeliveryOptions(){
  const country = form.country.value;
  deliveryOptionsDiv.innerHTML = '';
  if(country==='france'||country==='belgique'){
    deliveryOptionsDiv.innerHTML = `
      <label><input type="radio" name="delivery" value="domicile" required>Domicile 🏠</label>
      <label><input type="radio" name="delivery" value="point" required>Point Relais 📦</label>
      <label><input type="radio" name="delivery" value="locker" required>Locker 📮</label>
    `;
  }else if(country==='europe'){
    deliveryOptionsDiv.innerHTML = `<label><input type="radio" name="delivery" value="point" required>Point Relais 📦 (7.99€)</label>`;
  }
  updateTotal();
}

form.addEventListener('input', updateTotal);

function updateTotal(){
  const price = parseFloat(form.price.value)||0;
  const country = form.country.value;
  const deliveryOption = form.delivery?.value;
  let delivery = 0;
  if(country==='france'||country==='belgique'){
    delivery = price>=50?0:deliveryPrices[country][deliveryOption]||0;
  }else if(country==='europe'){
    delivery = price>=80?0:deliveryPrices.europe[deliveryOption]||0;
  }
  totalAmount = (price+delivery).toFixed(2);
  totalDisplay.textContent = (price>0&&country&&deliveryOption)?`Total: ${totalAmount} €`:'Total: -- €';
  renderPayPalButton();
}

function renderPayPalButton(){
  const container = document.getElementById('paypal-button-container');
  container.innerHTML='';
  if(!(parseFloat(totalAmount)>0)) return;
  paypal.Buttons({
    createOrder:function(data,actions){
      return actions.order.create({purchase_units:[{amount:{value:totalAmount}}]});
    },
    onApprove:function(data,actions){
      return actions.order.capture().then(function(details){
        alert('Paiement effectué avec succès — Merci '+(details.payer.name.given_name||''));
      });
    },
    onError:function(err){
      console.error(err);
      alert('Erreur PayPal: vérifier la console.');
    }
  }).render('#paypal-button-container');
}
</script>
</body>
</html>
